# To-Do List: API 개발

## **1. 데이터 수집 API**

### **📌 1.1. 작품 조회 기록 및 조회수 증가**
- **[ ] `POST /works/{id}/view`**
  - **설명:** 특정 작품이 조회될 때 조회수를 증가시키고, 조회 기록을 남김
  - **작업 내용:**
    - 사용자가 작품을 조회하면 `view_count` 증가
    - 조회 기록(`VIEW`)을 `user_activity` 테이블에 저장
    - 같은 사용자가 **1시간 내에 같은 작품을 다시 조회할 경우 중복 기록 방지**
    - 현재 조회수를 실시간으로 반환

---

### **📌 1.2. 작품 좋아요 추가**
- **[ ] `POST /works/{id}/like`**
  - **설명:** 특정 작품에 좋아요(`LIKE`)를 추가하고 기록을 저장
  - **작업 내용:**
    - 사용자가 작품을 좋아요하면 `like_count` 증가
    - `user_activity` 테이블에 새로운 `LIKE` 기록을 추가 (이전 기록은 삭제되지 않음)
    - 사용자가 이미 `LIKE`을 눌렀다면 **중복 좋아요 방지** (예외 처리)
    - 예외 발생 시 `409 Conflict` 응답 반환
    - 기존 `LIKE` 기록이 있다가 `UNLIKE`한 경우, **기록을 삭제하지 않고 새로운 `LIKE` 이벤트로 추가**

---

### **📌 1.3. 작품 좋아요 취소**
- **[ ] `DELETE /works/{id}/like`**
  - **설명:** 특정 작품의 좋아요(`LIKE`)를 취소하고 기록을 저장
  - **작업 내용:**
    - 사용자가 좋아요를 취소하면 `like_count` 감소
    - `user_activity` 테이블에 새로운 `UNLIKE` 기록을 추가 (`LIKE` 기록을 삭제하지 않음)
    - 사용자가 `LIKE`을 하지 않은 상태에서 `UNLIKE` 요청을 보내면 예외 처리 (`404 Not Found`)
    - 예외 발생 시 `404 Not Found` 응답 반환
    - 기존 `LIKE` 기록과 `UNLIKE` 기록을 통해 사용자의 좋아요 이력을 조회 가능

---

### **📌 1.4. 작품 데이터 통계 조회**
- **[ ] `GET /works/{id}/stats`**
  - **설명**: 특정 작품의 조회수, 좋아요 수, 댓글 수 등의 통계를 **사용자가 직접 지정한 기간(startDate~endDate) 
  또는 미리 정의된 기간(period: daily, weekly, monthly, yearly) 기준으로 실시간 조회하는 API**
  - **작업 목록**:
    - `startDate`, `endDate` 요청 파라미터를 추가하여 사용자가 원하는 기간 동안의 데이터를 조회할 수 있도록 변경
    - `period` 요청 파라미터 추가 (daily, weekly, monthly, yearly) → 입력값이 없으면 기본값 `daily`
    - `period`가 있으면 해당 기간을 자동으로 계산하여 `startDate`, `endDate` 값을 설정
    - `user_activity` 테이블에서 `activity_type`(VIEW, LIKE, COMMENT) 별로 `created_at` 기준으로 집계하여 데이터 반환
    - JPQL을 수정하여 `BETWEEN :startDate AND :endDate` 조건을 적용
    - 조회수(`views`), 좋아요(`likes`), 댓글 수(`comments`) 데이터를 포함하도록 응답 데이터 구조 정의
    - API 응답 최적화 (Map으로 변환하여 `activity_type` 별 개수 반환)
    - **조회하려는 작품이 존재하는지 확인** (`workId`가 존재하지 않으면 `NoSuchElementException` 발생)
    - **시작일이 종료일보다 클 경우 예외 발생** (`IllegalArgumentException`)

---

## **🔥 최종 정리**
| API | 동작 방식 | 예외 처리 |
|------|----------|----------|
| **`POST /works/{id}/view`** | 조회수 증가 + 조회 기록 저장 | 최근 1시간 내 중복 조회 방지 |
| **`POST /works/{id}/like`** | 좋아요 기록 추가 (`LIKE` 유지) | 중복 좋아요 시 `409 Conflict` 응답 |
| **`DELETE /works/{id}/like`** | 좋아요 취소 (`UNLIKE` 기록 추가) | 좋아요하지 않은 작품에 `UNLIKE` 요청 시 `404 Not Found` |

---

## 2. 데이터 조회 API
### 2.1.전체 작품 랭킹 조회
- [ ] **GET /ranking**
  - 설명: 모든 작품의 현재 랭킹 점수 조회.
  - 작업:
    - 랭킹 점수 계산: `(좋아요 수 × 2) + (조회수 × 1)`
    - 계산된 순위를 반환.

- [ ] **GET /ranking?date=YYYY-MM-DD**
  - 설명: 특정 날짜 기준 작품 랭킹 조회.
  - 작업:
    - 요청된 날짜의 랭킹 점수를 기준으로 순위 데이터 반환.

---

## 3. 리워드 지급 API
### 3.1. 리워드 지급 요청
- [ ] **POST /rewards/requests**
  - 설명: 관리자가 리워드 지급 요청을 생성.
  - 작업:
    - 특정 날짜를 기준으로 리워드 지급 요청 생성.
    - 요청 당일은 리워드 지급 기준 날짜로 설정 불가.

### 3.2. 리워드 지급 내역 조회
- [ ] **GET /rewards/history**
  - 설명: 모든 리워드 지급 내역 조회.
  - 작업:
    - 지급된 모든 리워드 정보를 반환.

- [ ] **GET /users/{id}/rewards**
  - 설명: 특정 사용자의 리워드 지급 내역 조회.
  - 작업:
    - 사용자 ID 기반으로 지급 내역 반환.
    - 지급 날짜, 지급 이유(랭킹 순위), 지급된 포인트 포함.

### 3.3. 상위 10위 리워드 지급
- [ ] **POST /rewards/execute**
  - 설명: 상위 10위 작품의 작가와 소비자에게 리워드 지급.
  - 작업:
    - 상위 10위 작품의 작가에게 리워드 지급.
      - 동일 작가에게는 리워드가 한 번만 지급.
    - 상위 10위 작품에 기여한 소비자에게 리워드 지급.
      - 각 소비자는 자신이 기여한 작품당 1개의 리워드만 받음.

---

## 4. 관리 및 사용자 API
### 4.1. 사용자 API
- [ ] **GET /users/{id}**
  - 설명: 특정 사용자의 프로필 정보 조회.
  - 작업:
    - 사용자 ID 기반으로 프로필 데이터 반환.

### 4.2. 작가 API
- [ ] **GET /authors/{id}/rewards**
  - 설명: 특정 작가의 리워드 지급 내역 조회.
  - 작업:
    - 작가 ID 기반으로 지급 내역 반환.

---

## 5. 추가 작업
- [ ] **H2 데이터베이스 콘솔 활성화**
  - URL: `/h2-console`
  - 작업: `application.properties`에 H2 콘솔 활성화 설정 추가.

---

## 작업 우선순위
1. **데이터 수집 API**:
  - 조회수, 좋아요 기록 및 상태 관리.
2. **데이터 조회 API**:
  - 작품별 통계 및 랭킹 조회.
3. **리워드 지급 API**:
  - 리워드 지급 요청 및 실행.
4. **관리 및 사용자 API**:
  - 사용자와 작가의 리워드 내역 조회.

---
